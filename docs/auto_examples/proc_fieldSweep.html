<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Check NMR/ESR resonance ratio using a field sweep &mdash; pyspecProcScripts 0.9 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../_static/gallery_custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Check Integration" href="integration_with_error.html" />
    <link rel="prev" title="&lt;no title&gt;" href="time_domain_noise.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pyspecProcScripts
          </a>
              <div class="version">
                0.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Lowest level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#first-level-in-this-repo">First level in this repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#second-level-in-this-repo">Second level in this repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#top-level">Top level</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ProcScripts Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="proc_square_refl.html">Process a square wave reflection</a></li>
<li class="toctree-l2"><a class="reference internal" href="generate_integrals_RealData.html">Convert 2D  Real Data into Integrals with Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="proc_var_tau.html">Echoes with varied tau lengths</a></li>
<li class="toctree-l2"><a class="reference internal" href="L2G.html">Lorentzian to Gaussian Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrate_limits_realData.html">Demonstrate Integrate Limits on Experimental Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hermitian_Phasing_Actual_var_tau.html">Phasing and Timing Correction Using a Varied Tau Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrate_limits.html">Demonstrate Integrate Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hermitian_Phasing_Actual_Challenging.html">Phasing and Timing Correction with Real Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="generate_integrals.html">Convert 2D to Integrals with Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="proc_capture_nutation.html">Captured Nutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hermitian_Phasing.html">Phasing and Timing Correction With Fake Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="check_integration_error.html">Check integral error calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlation_alignment_example.html">Align data with significant frequency drift</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Check NMR/ESR resonance ratio using a field sweep</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration_with_error.html">Check Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_error.html">Validate Inactive CT Error</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyspecProcScripts</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">ProcScripts Example Gallery</a></li>
      <li class="breadcrumb-item active">Check NMR/ESR resonance ratio using a field sweep</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/auto_examples/proc_fieldSweep.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-proc-fieldsweep-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="check-nmr-esr-resonance-ratio-using-a-field-sweep">
<span id="sphx-glr-auto-examples-proc-fieldsweep-py"></span><h1>Check NMR/ESR resonance ratio using a field sweep<a class="headerlink" href="#check-nmr-esr-resonance-ratio-using-a-field-sweep" title="Permalink to this heading">¶</a></h1>
<p>Analyzes field sweep data.  Determines the resonance frequency from the carrier
frequency and the offset of the signal, converts to MHz, then divide by the
Bridge 12 μw frequency stored in the file to get the resonance ratio of MHz/GHz</p>
<img src="../_images/sphx_glr_proc_fieldSweep_001.png" srcset="../_images/sphx_glr_proc_fieldSweep_001.png" alt="Raw data Frequency Domain, Field Slicing, Field Sweep ppt" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>C:\Users\jmfranck\pyspecdata.0.log appears to be locked or otherwise inaccessible: I&#39;m going to explore other options for fileno
----------  logging output to C:\Users\jmfranck\pyspecdata.9.log  ----------
--&gt; load_data.py(664):root  proc_field_sweep_v1 2023-05-13 16:28:49,121
INFO: WARNING WARNING, you are using the wrong version of the field sweep code -- should be chunked when data is saved, not on loading!
--&gt; load_data.py(667):root  proc_field_sweep_v1 2023-05-13 16:28:49,122
INFO: loading preprocessing for fieldsweep
C:\ProgramData\Anaconda3\lib\site-packages\matplotlib\cbook\__init__.py:1335: ComplexWarning: Casting complex values to real discards the imaginary part
  return np.asarray(x, float)
c:\users\jmfranck\git_repos\pyspecdata\pyspecdata\core.py:1959: UserWarning: linestyle is redundantly defined by the &#39;linestyle&#39; keyword argument and the fmt string &quot;o-&quot; (-&gt; linestyle=&#39;-&#39;). The keyword argument will take precedence.
  retval = myplotfunc(*plotargs,**kwargs)
c:\users\jmfranck\git_repos\pyspecdata\pyspecdata\core.py:1959: UserWarning: marker is redundantly defined by the &#39;marker&#39; keyword argument and the fmt string &quot;o-&quot; (-&gt; marker=&#39;o&#39;). The keyword argument will take precedence.
  retval = myplotfunc(*plotargs,**kwargs)
--&gt; proc_fieldSweep.py(111):pyspecdata.core             &lt;module&gt; 2023-05-13 16:28:50,884
INFO: ESR frequency is 9.820929
--&gt; proc_fieldSweep.py(112):pyspecdata.core             &lt;module&gt; 2023-05-13 16:28:50,885
INFO: MHz/GHz value at peak/dip appears to be: (1.5166088567255+6.791080188117843e-05j)
--&gt; legend.py(1330):matplotlib.legend   _parse_legend_args 2023-05-13 16:28:50,888
WARNING: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
--&gt; legend.py(1330):matplotlib.legend   _parse_legend_args 2023-05-13 16:28:50,889
WARNING: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspecdata</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspecProcScripts</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspecProcScripts</span> <span class="kn">import</span> <span class="n">lookup_table</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
<span class="n">init_logging</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
<span class="n">fl</span> <span class="o">=</span> <span class="n">figlist_var</span><span class="p">()</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;image.aspect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span> <span class="c1"># needed for sphinx gallery</span>

<span class="c1">#sphinx_gallery_thumbnail_number = 1</span>

<span class="n">signal_pathway</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ph1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">thisfile</span><span class="p">,</span><span class="n">exp_type</span><span class="p">,</span><span class="n">nodename</span><span class="p">,</span><span class="n">postproc</span><span class="p">,</span><span class="n">label_str</span><span class="p">,</span><span class="n">freq_slice</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;220217_5mM_TEMPOL_field_dep&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ODNP_NMR_comp/field_dependent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Field_sweep&#39;</span><span class="p">,</span>
            <span class="s1">&#39;field_sweep_v1&#39;</span><span class="p">,</span><span class="c1"># in newer version files, we should be setting</span>
            <span class="c1">#                  postproc_type as a top-level attribute of the</span>
            <span class="c1">#                  nddata, and this should not be necessary</span>
            <span class="s1">&#39;TEMPOL field sweep&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">)),</span>
        <span class="p">]:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">find_file</span><span class="p">(</span><span class="n">thisfile</span><span class="p">,</span><span class="n">exp_type</span><span class="o">=</span><span class="n">exp_type</span><span class="p">,</span><span class="n">expno</span><span class="o">=</span><span class="n">nodename</span><span class="p">,</span>
            <span class="n">postproc</span><span class="o">=</span><span class="n">postproc</span><span class="p">,</span><span class="n">lookup</span><span class="o">=</span><span class="n">lookup_table</span><span class="p">)</span>
    <span class="c1">#{{{Obtain ESR frequency and chunk/reorder dimensions</span>
    <span class="n">nu_B12_GHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_prop</span><span class="p">(</span><span class="s1">&#39;acq_params&#39;</span><span class="p">)[</span><span class="s1">&#39;mw_freqs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1e9</span>
    <span class="c1">#}}}</span>
    <span class="c1">#{{{DC offset correction</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="s1">&#39;ph1&#39;</span><span class="p">)</span>
    <span class="n">t2_max</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rx_offset_corr</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">:(</span><span class="n">t2_max</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span><span class="kc">None</span><span class="p">)]</span>
    <span class="n">rx_offset_corr</span> <span class="o">=</span> <span class="n">rx_offset_corr</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s1">&#39;t2&#39;</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">-=</span> <span class="n">rx_offset_corr</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ft</span><span class="p">([</span><span class="s1">&#39;ph1&#39;</span><span class="p">])</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="c1">#}}}</span>
    <span class="c1"># {{{ set up figure and plot raw data</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s1">&#39;Field Sweep Processing&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Raw data</span><span class="se">\n</span><span class="s1">Frequency Domain&#39;</span><span class="p">)</span>
    <span class="c1"># }}}</span>
    <span class="c1">#{{{frequency filtering and phase correct</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e3</span><span class="p">)]</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="n">best_shift</span> <span class="o">=</span> <span class="n">hermitian_function_test</span><span class="p">(</span><span class="n">select_pathway</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">signal_pathway</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">setaxis</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">-</span><span class="n">best_shift</span><span class="p">)</span><span class="o">.</span><span class="n">register_axis</span><span class="p">({</span><span class="s1">&#39;t2&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)]</span>
    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.5</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">select_pathway</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">signal_pathway</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">/=</span> <span class="n">zeroth_order_ph</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">))</span>
    <span class="n">nu_NMR</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;Field&#39;</span><span class="p">,</span> <span class="s1">&#39;carrierFreq&#39;</span><span class="p">},</span> <span class="s2">&quot;&#39;indirect&#39; axis should be a structured array that stores the carrier frequency and the field&quot;</span>
    <span class="c1"># {{{ the following works fine for all the cases that we&#39;ve tested, and so</span>
    <span class="c1"># there&#39;s no need to change it.  But, after resolving everything, realized</span>
    <span class="c1"># that the best way to deal with this would be to run a correlation on all</span>
    <span class="c1"># the scans to determine the relative offsets, which would give both the</span>
    <span class="c1"># relative offsets and the frequency shifts needed to align the signals, at</span>
    <span class="c1"># the end.</span>
    <span class="n">all_offsets</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">))):</span>
        <span class="n">fl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;indirect&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">freq_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">freq_slice</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;indirect&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nScans&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">all_offsets</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="n">carrier_freq_MHz</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">)[</span><span class="n">z</span><span class="p">][</span><span class="s1">&#39;carrierFreq&#39;</span><span class="p">]</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">)[</span><span class="n">z</span><span class="p">][</span><span class="s1">&#39;Field&#39;</span><span class="p">]</span>
        <span class="n">nu_rf</span> <span class="o">=</span> <span class="n">carrier_freq_MHz</span> <span class="o">-</span> <span class="n">offset</span><span class="o">/</span><span class="mf">1e6</span> <span class="c1"># because in order to make my</span>
        <span class="c1">#                                       offset more negative, I</span>
        <span class="c1">#                                       increase my field, or decrease</span>
        <span class="c1">#                                       my carrier -- in other words</span>
        <span class="c1">#                                       the frequency axis for our FID</span>
        <span class="c1">#                                       is the negative of (ν_RF-ν_carrier)</span>
        <span class="n">nu_NMR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nu_rf</span><span class="p">)</span>
    <span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field Slicing&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">*=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">nddata</span><span class="p">(</span><span class="n">all_offsets</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;indirect&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">fromaxis</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="c1"># }}}</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nScans&#39;</span><span class="p">),</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">:</span><span class="n">freq_slice</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nScans&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">)</span>
    <span class="c1">#}}}</span>
    <span class="c1">#{{{convert x axis to ppt = v_NMR/v_ESR</span>
    <span class="n">ppt</span> <span class="o">=</span> <span class="n">nu_NMR</span> <span class="o">/</span> <span class="n">nu_B12_GHz</span>
    <span class="n">s</span><span class="o">.</span><span class="n">setaxis</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">,</span><span class="n">ppt</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">set_units</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">,</span><span class="s1">&#39;MHz/GHz&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;indirect&#39;</span><span class="p">,</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">)</span>
    <span class="c1">#}}}</span>
    <span class="c1">#{{{Fitting</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field Sweep ppt&#39;</span><span class="p">)</span>
    <span class="n">fitting</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">field_fine</span> <span class="o">=</span> <span class="n">nddata</span><span class="p">(</span><span class="n">r_</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span><span class="n">s</span><span class="o">.</span><span class="n">getaxis</span><span class="p">(</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="mi">100</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">)</span>
    <span class="n">polyline</span> <span class="o">=</span> <span class="n">fl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">field_fine</span><span class="o">.</span><span class="n">eval_poly</span><span class="p">(</span><span class="n">fitting</span><span class="p">,</span><span class="s1">&#39;resonance ratio&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">fitting</span>
    <span class="n">center</span> <span class="o">=</span> <span class="o">-</span><span class="n">B</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">A</span>
    <span class="c1">#}}}</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="s2">&quot;ESR frequency is </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">nu_B12_GHz</span><span class="p">)))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">strm</span><span class="p">(</span><span class="s2">&quot;MHz/GHz value at peak/dip appears to be:&quot;</span><span class="p">,</span><span class="n">center</span><span class="p">))</span>
    <span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">polyline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">fl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  2.055 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-proc-fieldsweep-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/f52d6fc95aa3bfcd7f7400f0f7c343b6/proc_fieldSweep.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">proc_fieldSweep.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/2bb316154bf32a6027e189fc5a6b0f8b/proc_fieldSweep.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">proc_fieldSweep.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="time_domain_noise.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="integration_with_error.html" class="btn btn-neutral float-right" title="Check Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, John M. Franck group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>